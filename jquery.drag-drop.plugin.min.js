(function(a){function k(a){e!=null&&(a.dropClass&&e.removeClass(a.dropClass),e=null),d!=null&&a.canDropClass&&d.removeClass(a.canDropClass)}var b={makeClone:!1,sourceClass:null,sourceHide:!1,dragClass:null,canDropClass:null,dropClass:null,isActive:!0,container:null,minimumDistance:10,canDrag:function(a,b){return a},canDrop:function(a){return a.hasClass("drop")||a.parents(".drop").size()>0},didStart:function(){},didDrop:function(a,b){a.appendTo(b)},didFinish:function(){}},c=null,d=null,e=null,f,g,h,i,j,l={init:function(c){return c=a.extend({},b,c),this.data("options",c),this.bind("mousedown.dragdrop touchstart.dragdrop",l.onStart),this},destroy:function(){return this.unbind("mousedown.dragdrop touchstart.dragdrop"),this},on:function(){this.data("options").isActive=!0},off:function(){this.data("options").isActive=!1},onStart:function(b){var e=a(this),j=e.data("options");if(!j.isActive)return;var k=j.canDrag(e,b);if(k){c=k,d=null;var m=c.offset();return h=m.left,i=m.top,b.type=="touchstart"?(f=b.originalEvent.touches[0].clientX-m.left,g=b.originalEvent.touches[0].clientY-m.top):(f=b.pageX-m.left,g=b.pageY-m.top),a(window).bind("mousemove.dragdrop touchmove.dragdrop",{source:e},l.onMove).bind("mouseup.dragdrop touchend.dragdrop",{source:e},l.onEnd),b.stopPropagation(),!1}},whenDragging:function(a){var b=a.data("options"),e=c.offset(),f=c.width(),g=c.height();b.makeClone?(d=c.clone(!1),d.appendTo(c.parent()),b.sourceClass?c.addClass(b.sourceClass):b.sourceHide&&c.css("visibility","hidden")):d=c,d.css({position:"absolute",left:e.left,top:e.top,width:f,height:g}),b.dragClass&&d.addClass(b.dragClass);var h=b.container;if(h){var e=h.offset();j={minX:e.left,minY:e.top,maxX:e.left+h.outerWidth()-c.outerWidth(),maxY:e.top+h.outerHeight()-c.outerHeight()}}b.didStart()},onMove:function(b){var c=b.data.source,m=c.data("options"),n,o;b.type=="touchmove"?(n=b.originalEvent.touches[0].clientX,o=b.originalEvent.touches[0].clientY):(n=b.pageX,o=b.pageY);var p=Math.abs(n-h-f),q=Math.abs(o-i-g);!d&&(p>m.minimumDistance||q>m.minimumDistance)&&l.whenDragging(c);if(!d)return;d.css("display","none");var r=document.elementFromPoint(n-document.documentElement.scrollLeft-document.body.scrollLeft,o-document.documentElement.scrollTop-document.body.scrollTop);d.css("display",""),n-=f,o-=g,j&&(n=Math.min(Math.max(n,j.minX),j.maxX),o=Math.min(Math.max(o,j.minY),j.maxY)),d.css({left:n,top:o});if(r){if(e==null||e.get(0)!=r){var s=a(r);m.canDrop(s)?(m.dropClass&&(e!=null&&e.removeClass(m.dropClass),s.addClass(m.dropClass)),m.canDropClass&&d.addClass(m.canDropClass),e=s):e!=null&&k(m)}}else e!=null&&k(m);return b.stopPropagation(),!1},onEnd:function(b){a(window).unbind("mousemove.dragdrop touchmove.dragdrop"),a(window).unbind("mouseup.dragdrop touchend.dragdrop");if(!d)return;var f=b.data.source,g=f.data("options");e&&g.didDrop(c,e),k(g),g.makeClone?(d.remove(),g.sourceClass?c.removeClass(g.sourceClass):g.sourceHide&&c.css("visibility","visible")):(d.css("position","static"),d.css("width",""),d.css("height",""),g.dragClass&&d.removeClass(g.dragClass)),c=d=j=null,g.didFinish()}};a.fn.dragdrop=function(b){if(l[b])return l[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return l.init.apply(this,arguments);a.error("Method "+b+" does not exist on jQuery.dragdrop")}})(jQuery);